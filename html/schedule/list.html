{% extends 'main/main.html' %}

{% block content %}
    <div class="d-flex flex-column flex-column-fluid">
        <!--begin::Toolbar-->
        <div id="kt_app_toolbar" class="app-toolbar pt-6 pb-2">
            <!--begin::Toolbar container-->
            <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
                <!--begin::Toolbar wrapper-->
                <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
                    <!--begin::Page title-->
                    <div class="page-title d-flex flex-column justify-content-center gap-1 me-3">
                        <!--begin::Title-->
                        <h1 class="page-heading d-flex flex-column justify-content-center text-gray-900 fw-bold fs-3 m-0">
                            O'quv rejalar ro'yxati</h1>
                        <!--end::Title-->
                        <!--begin::Breadcrumb-->
                        <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0">
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">
                                <a href="{% url 'home' %}" class="text-muted text-hover-primary">Dashboard</a>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-500 w-5px h-2px"></span>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">O'quv rejalar</li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item">
                                <span class="bullet bg-gray-500 w-5px h-2px"></span>
                            </li>
                            <!--end::Item-->
                            <!--begin::Item-->
                            <li class="breadcrumb-item text-muted">Ro'yxati</li>
                            <!--end::Item-->
                        </ul>
                        <!--end::Breadcrumb-->
                    </div>
                    <!--end::Page title-->
                    <!--begin::Actions-->
                    <div class="d-flex align-items-center gap-2 gap-lg-3">

                    </div>
                    <!--end::Actions-->
                </div>
                <!--end::Toolbar wrapper-->
            </div>
            <!--end::Toolbar container-->
        </div>
        <!--end::Toolbar-->
        <!--begin::Content-->
        <div id="kt_app_content" class="app-content flex-column-fluid">
            <!--begin::Content container-->
            <div id="kt_app_content_container" class="app-container container-fluid">
                <!--begin::Category-->
                <form method="get">
                    <!--begin::Card-->
                    <div class="card mb-7">
                        <!--begin::Card body-->
                        <div class="card-body">
                            <!--begin::Compact form-->
                            <div class="d-flex align-items-center">
                                <!--begin::Input group-->
                                <div class="position-relative w-md-400px me-md-2">
                                                                        <h5 class="text-muted mb-0">Qidiruv</h5>
                                    <input type="text" class="form-control form-control-solid"
                                           name="search"
                                           {% if request.GET.search %}value="{{ request.GET.search }}" {% endif %}
                                           placeholder="Qidiruv fish bo'yicha">
                                </div>
                                <div class="position-relative w-md-400px me-md-2">
                                    <h5 class="text-muted mb-0">Dars sanasi</h5>
                                    <input type="date" value="{{ selected_date|date:'Y-m-d' }}" placeholder="Pick date rage" class="form-control form-control-solid "
                                    name="date">

                                </div>
                                <div class="position-relative w-md-400px me-md-2">
                                    <h5 class="text-muted mb-0">Ovoz berganlar bo'yicha</h5>
                                    <select name="send_answer" class="form-select form-select-solid" >
                                        <option value="0">--------------</option>
                                        <option value="1" {% if request.GET.send_answer == '1' %}selected{% endif %}>Faqat ovoz berganlar</option>
                                        <option value="2" {% if request.GET.send_answer == '2' %}selected{% endif %}>Faqat ovoz berilmaganlari</option>
                                    </select>
                                </div>
                                <!--end::Input group-->

                                <!--begin:Action-->
                                <div class="d-flex align-items-center">
                                    <button type="submit" class="btn btn-icon btn-lg btn-primary me-1">
                                        <i class="las la-search fs-2 "></i>
                                    </button>

                                    {% if request.GET %}
                                    <a href="{{ request.path }}" class="btn btn-icon btn-lg btn-danger me-5">
                                        <i class="las la-search-minus fs-2"></i>
                                    </a>
                                    {% else %}
                                    <button type="button" disabled class="btn btn-icon btn-lg btn-danger me-5">
                                        <i class="las la-search-minus fs-2"></i>
                                    </button>
                                    {% endif %}

                                </div>
                                <!--end:Action-->
                            </div>
                            <!--end::Compact form-->

                        </div>
                        <!--end::Card body-->
                    </div>
                    <!--end::Card-->
                </form>


                <div class="d-flex flex-wrap flex-stack pb-7">
                        <!--begin::Title-->
                        <div class="d-flex flex-wrap align-items-center my-1">
                                        <h6 class="fw-bold me-5 my-1">
                                           Soni : {{ queryset_count }} Ta
    {#                                <span class="text-gray-500 fs-6">by Recent Updates ↓</span>#}
                                </h6>
                                </div>
                    <form method="get" class="d-inline">
                        <button type="submit" name="export" value="excel" class=" d-inline btn btn-success"><i class="fas fa-file-excel fs-2"></i> Javob berilganlarni excel export</button>
                    </form>
                    </div>


                <div class="card card-flush">
                    <!--begin::Card body-->
                    <div class="card-body pt-0">

                        <div class="table-responsive">
                            <!--begin::Table-->
                            <table class="table align-middle table-row-dashed fs-6 gy-5" id="kt_ecommerce_category_table">
                                <thead>
                                <tr class="text-start text-gray-500 fw-bold fs-7 text-uppercase gs-0">
                                    <th>#</th>
                                    <th class="min-w-250px">Kafedra</th>
                                    <th class="min-w-250px">FISH</th>
                                    <th class="min-w-250px">Fan nomi</th>
                                    <th class="min-w-250px">Ovoz berishi kerak bo'lganlar</th>
                                    <th class="min-w-250px">Ovoz berganlar soni</th>
                                    <th class="min-w-250px">Dars sanasi</th>
                                </tr>
                                </thead>
                                <tbody class="fw-semibold text-gray-600">
                                {% if queryset %}
                                {% for i in queryset %}
                                    <tr>
                                        <td>
                                            <a
                                               class="btn btn-icon btn-dark"
                                               >
                                              <i class="la la-info-circle fs-2"></i>
                                            </a>

                                        </td>
                                        <td>
                                            <h6>
                                                {{ i.department.name }}
                                            </h6>
                                        </td>
                                        <td>
                                            <h6>
                                                {{ i.employee.full_name }}
                                            </h6>
                                        </td>
                                        <td>
                                            {{i.subject.name}}
                                        </td>
                                        <td>
                                            {{i.group_student_count_qs}} ta
                                        </td>
                                        <td>
                                            {{i.answer_send_count_qs}} ta
                                        </td>
                                        <td>
                                            {{i.lesson_date|date}} <br>
                                            <span class="badge  badge-dark">{{ i.lesson_pair.start_time }} dan, {{ i.lesson_pair.end_time }} gacha</span>
                                        </td>
                                    </tr>
                                {% endfor %}
                                {% else %}
                                    <tr>
                                    <td colspan="5" class="h-20px">
                                        <h4 class="text-center">Ma'lumot topilmadi</h4>
                                    </td>
                                    </tr>
                                {% endif %}
                                </tbody>
                            </table>
                        </div>

                        {% if queryset %}
                        <div class="mt-5">
                            <ul class="pagination pagination-circle">
                                {# Previous tugma #}
                                {% if queryset.has_previous %}
                                    <li class="page-item previous">
                                        <a href="?page={{ queryset.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">
                                            <i class="previous"></i>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item previous disabled">
                                        <a href="#" class="page-link"><i class="previous"></i></a>
                                    </li>
                                {% endif %}

                                {# Raqamlar #}
                                {% for num in queryset.paginator.page_range %}
                                    {% if num == queryset.number %}
                                        <li class="page-item active">
                                            <a href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">{{ num }}</a>
                                        </li>
                                    {% else %}
                                        <li class="page-item">
                                            <a href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">{{ num }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}

                                {# Next tugma #}
                                {% if queryset.has_next %}
                                    <li class="page-item next">
                                        <a href="?page={{ queryset.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" class="page-link">
                                            <i class="next"></i>
                                        </a>
                                    </li>
                                {% else %}
                                    <li class="page-item next disabled">
                                        <a href="#" class="page-link"><i class="next"></i></a>
                                    </li>
                                {% endif %}
                            </ul>
                        <div class="mt-5">
                            <h6 class="text-center text-muted fs-sm">Sahifa soni : {{ queryset.paginator.num_pages }} ta</h6>
                        </div>
                        </div>
                    {% endif %}


                    <!--end::Card body-->
                </div>
                <!--end::Category-->
            </div>
            <!--end::Content container-->
        </div>
        <!--end::Content-->
    </div>

    <div class="modal fade" tabindex="-1" id="kt_modal_stacked_1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form method="post">
                    {% csrf_token %}
                    <div class="modal-header">
                        <h3 class="modal-title">Yangi qiymat turi qo'shish</h3>

                        <!--begin::Close-->
                        <div class="btn btn-icon btn-sm btn-active-light-primary ms-2" data-bs-dismiss="modal"
                             aria-label="Close">
                            <i class="ki-duotone ki-cross fs-1"><span class="path1"></span><span class="path2"></span></i>
                        </div>
                        <!--end::Close-->
                    </div>

                    <div class="modal-body">
                        <label for="name">Qiymat nomini kiriting</label>
                        <input type="text" id="name" class="form-control" name="name" max="220" required placeholder="Qiymat turining nomini kiriting..">
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Chiqish</button>
                        <button type="submit" class="btn btn-primary">Qo'shish</button>
                    </div>
                </form>
            </div>
        </div>
    </div>




<!-- Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form id="editForm" method="post">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title">O‘zgartirish</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" id="editId">
          <input type="hidden" name="type" value="edit">
          <div class="mb-3">
            <label for="editName" class="form-label">Nomi</label>
            <input type="text" class="form-control" name="name" id="editName">
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Saqlash</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block footer %}
    <script>
    const editModal = document.getElementById('editModal')
        editModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget
            const id = button.getAttribute('data-id')
            const name = button.getAttribute('data-name')

            // Form inputlariga yozish
            document.getElementById('editId').value = id
            document.getElementById('editName').value = name
        })
    </script>
{% endblock %}