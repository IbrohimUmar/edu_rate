{% extends 'main/main.html' %}
{% load static %}

{% block content %}
<div class="d-flex flex-column flex-column-fluid">

    <div id="kt_app_toolbar" class="app-toolbar pt-6 pb-2">
        <!--begin::Toolbar container-->
        <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
            <!--begin::Toolbar wrapper-->
            <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
                <!--begin::Page title-->
                <div class="page-title d-flex flex-column justify-content-center gap-1 me-3">
                    <!--begin::Title-->
                    <h1 class="page-heading d-flex flex-column justify-content-center text-gray-900 fw-bold fs-3 m-0">
                        Dashboard</h1>
                    <!--end::Title-->
                    <!--begin::Breadcrumb-->
<!--                    <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0">-->
<!--                        &lt;!&ndash;begin::Item&ndash;&gt;-->
<!--                        <li class="breadcrumb-item text-muted">Dashboard</li>-->
<!--                        &lt;!&ndash;end::Item&ndash;&gt;-->
<!--                    </ul>-->
                    <!--end::Breadcrumb-->
                </div>
            </div>
            <!--end::Toolbar wrapper-->
        </div>
        <!--end::Toolbar container-->
    </div>

    <!--begin::Content-->
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <!--begin::Content container-->
        <div id="kt_app_content_container" class="app-container container-fluid">
            <!--begin::Row-->
            <div class="row gx-5 g-xl-10 g-xl-10">



                <div class="col-md-6 col-lg-6 col-xl-6 mt-1">
                    <div class="border border-dashed border-gray-300 text-center min-w-125px rounded pt-4 pb-2 my-3">
                        <span class="fs-4 fw-semibold text-success d-block"><i class="fas fa-users"></i> Jami talaba soni</span>
                        <span class="fs-2hx fw-bold text-gray-900 counted" data-kt-countup="true"
                              data-kt-countup-value="{{user_statistic.total_student_count}}" data-kt-initialized="1">{{user_statistic.total_student_count}} ta</span>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-6 mt-1">
                    <div class="border border-dashed border-gray-300 text-center min-w-125px rounded pt-4 pb-2 my-3">
                        <span class="fs-4 fw-semibold text-success d-block"><i class="fas fa-key"></i> Ro'yxatdan o'tgan talaba soni</span>
                        <span class="fs-2hx fw-bold text-gray-900 counted" data-kt-countup="true"
                              data-kt-countup-value="{{user_statistic.total_registered_count}}" data-kt-initialized="1">{{user_statistic.total_registered_count}} ta</span>
                    </div>
                </div>


                <div class="col-md-6 col-lg-4 col-xl-4 mt-1">
                    <div class="border border-dashed border-gray-300 text-center min-w-125px rounded pt-4 pb-2 my-3">
                        <span class="fs-4 fw-semibold text-success d-block"><i class="fas fa-paper-plane"></i> Yuborilgan so'rovnoma soni</span>
                        <span class="fs-2hx fw-bold text-gray-900 counted" data-kt-countup="true"
                              data-kt-countup-value="{{schedule_point.total_send_notify_count}}" data-kt-initialized="1">{{schedule_point.total_send_notify_count}} ta</span>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4 col-xl-4 mt-1">
                    <div class="border border-dashed border-gray-300 text-center min-w-125px rounded pt-4 pb-2 my-3">
                        <span class="fs-4 fw-semibold text-success d-block"><i class="fas fa-message"></i> Javoblangan so'rovnoma soni</span>
                        <span class="fs-2hx fw-bold text-gray-900 counted" data-kt-countup="true"
                              data-kt-countup-value="{{schedule_point.total_answers_count}}" data-kt-initialized="1">{{schedule_point.total_answers_count}} ta</span>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4 col-xl-4 mt-1">
                    <div class="border border-dashed border-gray-300 text-center min-w-125px rounded pt-4 pb-2 my-3">
                        <span class="fs-4 fw-semibold text-success d-block"><i class="fas fa-ban"></i> Javoblanmagan so'rovnoma soni</span>
                        <span class="fs-2hx fw-bold text-gray-900 counted" data-kt-countup="true"
                              data-kt-countup-value="{{schedule_point.total_not_answered_count}}" data-kt-initialized="1">{{schedule_point.total_not_answered_count}} ta</span>
                    </div>
                </div>


                <div class="col-md-2 col-sm-2 col-xl-2">

                    <div class="col-sm-12 col-md-12 col-xl-12">
                        <a href="{% url 'survey_list' %}" class="card bg-light-dark hoverable shadow-sm text-center py-3">
                          <div class="card-body">
                            <i class="ki-outline ki-questionnaire-tablet fs-3x text-dark mb-4"></i>
                            <h3 class="fs-5 text-dark fw-bold mb-0">So'rovnomalar</h3>
                          </div>
                        </a>
                      </div>

                    <div class="col-sm-12 col-md-12 col-xl-12 mt-5">
                        <a href="{% url 'teacher_list' %}" class="card bg-light-dark hoverable shadow-sm text-center py-3">
                          <div class="card-body">
                            <i class="ki-outline ki-profile-user fs-3x text-dark mb-4"></i>
                            <h3 class="fs-5 text-dark fw-bold mb-0">Pedagoglar</h3>
                          </div>
                        </a>
                      </div>

                    <div class="col-sm-12 col-md-12 col-xl-12 mt-5">
                        <a href="{% url 'teacher_list' %}" class="card bg-light-dark hoverable shadow-sm text-center py-3">
                          <div class="card-body">
                            <i class="ki-outline ki-calendar  fs-3x text-dark mb-4"></i>
                            <h3 class="fs-5 text-dark fw-bold mb-0">Dars jadvali</h3>
                          </div>
                        </a>
                      </div>
                </div>


                <div class="col-md-10">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="card-title text-center">Savollar bo‘yicha o‘rtacha mamnuniyat</h6>
                        </div>
                        <div class="card-body">
                            <table class="table p-6 table-row-bordered dataTables table-row-gray-100 align-middle" id="dataTable">
                                <thead>
                                <tr class="fw-bold text-muted bg-light">
                                    <th class="ps-4 rounded-start">Savol nomi</th>
                                    <th>Turi</th>
                                    <th>Poziv</th>
                                    <th>Normal</th>
                                    <th class="rounded-end">Negativ</th>
                                </tr>

                                </thead>
                                <tbody>
                                {% for data in chart_data %}
                                <tr>
                                    <td>{{data.question}}</td>
                                    <td>
<!--                                        <span class="badge badge-light-light text-gray-800 badge-lg">Bakalarv uchun</span>-->
                                        <span class="badge badge-light-light text-gray-800 badge-lg">{{data.question_edu_type}}</span>
                                    </td>
<!--                                    <td style="background-color: rgba(1,106,39,0.11)">{{data.positive}} ta</td>-->
<!--                                    <td style="background-color: rgba(106,92,1,0.11)">{{data.normal}} ta</td>-->
<!--                                    <td style="background-color: rgba(106,1,1,0.16)">{{data.negative}} ta</td>-->
                                    <td >{{data.positive}} ta</td>
                                    <td >{{data.normal}} ta</td>
                                    <td >{{data.negative}} ta</td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
                </div>

            </div>
            <!--end::Row-->
        </div>
        <!--end::Content container-->
    </div>
    <!--end::Content-->
</div>
{% endblock %}
{% block header %}
<link href="{% static '' %}plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css"/>
<script src="{% static '' %}plugins/global/plugins.bundle.js"></script>

{% endblock %}

{% block footer %}
<script>
var element = document.getElementById('kt_apexcharts_1');

// if (!element) { return; }

var height = 500; // İster KTUtil.css(element, 'height') kullan
var labelColor = KTUtil.getCssVariableValue('--kt-gray-500');
var borderColor = KTUtil.getCssVariableValue('--kt-gray-200');
var baseColor = '#4caf50';      // Pozitif → yeşil
var normalColor = '#ffeb3b';    // Normal → sarı
var negativeColor = '#f44336';  // Negatif → kırmızı

var chartData = {{ chart_data|safe }};

var options = {
    series: [
        { name: 'Pozitif', data: chartData.map(q => q.positive) },
        { name: 'Normal', data: chartData.map(q => q.normal) },
        { name: 'Negatif', data: chartData.map(q => q.negative) },
    ],
    chart: {
        type: 'bar',
        height: height,
        stacked: false,
        toolbar: { show: false }
    },
    plotOptions: {
        bar: {
            horizontal: true, // uzun sorular için yatay
            columnWidth: '40%',
            endingShape: 'rounded'
        }
    },
    dataLabels: { enabled: false },
    stroke: { show: true, width: 2, colors: ['transparent'] },
    xaxis: {
        categories: chartData.map(q => q.question),
        labels: {
            style: { colors: labelColor, fontSize: '12px' },
            formatter: function(val) {
                return val.length > 50 ? val.substring(0, 50) + '...' : val;
            }
        },
        axisBorder: { show: false },
        axisTicks: { show: false }
    },
    yaxis: {
        labels: { style: { colors: labelColor, fontSize: '12px' } }
    },
    colors: [baseColor, normalColor, negativeColor],
    tooltip: {
        y: {
            formatter: function(val) {
                return val + " kişi";
            }
        }
    },
    grid: {
        borderColor: borderColor,
        strokeDashArray: 4,
        yaxis: { lines: { show: true } }
    },
    legend: { position: 'top' }
};
var options_new = {
    series: [
        { name: 'Pozitif', data: chartData.map(q => q.positive) },
        { name: 'Normal', data: chartData.map(q => q.normal) },
        { name: 'Negatif', data: chartData.map(q => q.negative) },
    ],
    chart: { type: 'bar', height: height, stacked: false, toolbar: { show: false } },
    plotOptions: { bar: { horizontal: true, columnWidth: '40%', endingShape: 'rounded' } },
    colors: [baseColor, normalColor, negativeColor], // sabit renkler burada
    xaxis: { categories: chartData.map(q => q.question) },
    tooltip: { y: { formatter: val => val + ' kişi' } }
};

var chart = new ApexCharts(element, options_new);
chart.render();
</script>
{% endblock %}